Index: urlTobase64.py
===================================================================
diff --git a/urlTobase64.py b/urlTobase64.py
deleted file mode 100644
--- a/urlTobase64.py	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
+++ /dev/null	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
@@ -1,34 +0,0 @@
-from flask import Flask, request
-
-app = Flask(__name__)
-
-
-from flask import Flask, request
-import requests
-import base64
-
-app = Flask(__name__)
-
-@app.route('/image_to_base64', methods=['GET'])
-def image_to_base64():
-    image_url = request.args.get('image_url')
-
-    if not image_url:
-        return {'error': 'Image URL parameter is missing.'}, 400
-
-    try:
-        # 获取图片内容
-        response = requests.get(image_url, verify=False)
-        if response.status_code == 200:
-            # 将图片内容转换为 Base64 编码
-            image_base64 = base64.b64encode(response.content).decode('utf-8')
-            return {'base64': image_base64}
-        else:
-            return {'error': 'Failed to fetch image from URL.'}, 404
-    except Exception as e:
-        return {'error': str(e)}, 500
-
-
-
-if __name__ == '__main__':
-    app.run(host='0.0.0.0', port=9999)
Index: pages/midjourney/midjourney.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// pages/index/component/form/form.js\r\nconst app = getApp();\r\nlet leftHeight = 0;\r\nlet rightHeight = 0;\r\nlet leftData = [];\r\nlet rightData = [];\r\nlet loading = true;\r\nlet loadingTop = true;\r\nPage({\r\n\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    ColorList: app.globalData.ColorList,\r\n    color: 'red',\r\n    canvasW: 220,\r\n    canvasH: 220,\r\n    data_list: [{\r\n        value: 0,\r\n        lineColor: 'red',\r\n        lineWidth: 2\r\n      },\r\n      {\r\n        value: 10,\r\n        lineColor: 'red',\r\n        lineWidth: 2\r\n      },\r\n      {\r\n        value: 20,\r\n        lineColor: 'red',\r\n        lineWidth: 2\r\n      },\r\n      {\r\n        value: 30,\r\n        lineColor: 'red',\r\n        lineWidth: 3\r\n      },\r\n      {\r\n        value: 40,\r\n        lineColor: 'green',\r\n        lineWidth: 3\r\n      },\r\n      {\r\n        value: 50,\r\n        lineColor: 'green',\r\n        lineWidth: 3\r\n      },\r\n      {\r\n        value: 60,\r\n        lineColor: 'green',\r\n        lineWidth: 3\r\n      },\r\n      {\r\n        value: 70,\r\n        lineColor: 'green',\r\n        lineWidth: 4\r\n      },\r\n      {\r\n        value: 80,\r\n        lineColor: '#37c0fe',\r\n        lineWidth: 4\r\n      },\r\n      {\r\n        value: 90,\r\n        lineColor: '#37c0fe',\r\n        lineWidth: 4\r\n      },\r\n      {\r\n        value: 100,\r\n        lineColor: '#37c0fe',\r\n        lineWidth: 4\r\n      },\r\n      {\r\n        value: 101,\r\n        lineColor: '#37c0fe',\r\n        lineWidth: 5\r\n      },\r\n    ],\r\n    // 环形进度条参数\r\n    circleDiam: 80, // 圆环直径\r\n    cententDiam: 70, // 中心圆直径\r\n    bgColor: '#e9e9e9',\r\n    curColor: 'linear-gradient(#7affaf, #7a88ff)',\r\n    value: 70,\r\n    StatusBar: app.globalData.StatusBar,\r\n    CustomBar: app.globalData.CustomBar,\r\n    sex: \"女\",\r\n    b1: true,\r\n    b2: true,\r\n    b3: true,\r\n    process: '0%',\r\n    ischecked: undefined,\r\n    index: null,\r\n    picker: ['喵喵喵', '汪汪汪', '哼唧哼唧'],\r\n    multiArray: [\r\n      ['无脊柱动物', '脊柱动物'],\r\n      ['扁性动物', '线形动物', '环节动物', '软体动物', '节肢动物'],\r\n      ['猪肉绦虫', '吸血虫']\r\n    ],\r\n    imgs: [],\r\n    leftData: [],\r\n    rightData: [],\r\n    orgData: [\r\n      // {\r\n      //   title: \"瀑布流示例1\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597216923945.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例2\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597212878479.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例3\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597202859053.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例4\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597705129774.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例4\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597693669650.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例4\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597676831426.jpeg\"\r\n      // },\r\n      // {\r\n      //   title: \"瀑布流示例4\",\r\n      //   name: \"WaterFall\",\r\n      //   image: \"https://cxy-csx.top/13334597669567060.jpeg\"\r\n      // }\r\n    ],\r\n    flag: true,\r\n    objectMultiArray: [\r\n      [{\r\n          id: 0,\r\n          name: '无脊柱动物'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '脊柱动物'\r\n        }\r\n      ],\r\n      [{\r\n          id: 0,\r\n          name: '扁性动物'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '线形动物'\r\n        },\r\n        {\r\n          id: 2,\r\n          name: '环节动物'\r\n        },\r\n        {\r\n          id: 3,\r\n          name: '软体动物'\r\n        },\r\n        {\r\n          id: 3,\r\n          name: '节肢动物'\r\n        }\r\n      ],\r\n      [{\r\n          id: 0,\r\n          name: '猪肉绦虫'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '吸血虫'\r\n        }\r\n      ]\r\n    ],\r\n    multiIndex: [0, 0, 0],\r\n    time: '13:01',\r\n    date: '2022-12-25',\r\n    region: ['北京市', '北京市', '朝阳区'],\r\n    imgList: [],\r\n    modalName: null,\r\n    textareaAValue: '',\r\n    textareaBValue: ''\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  create(data) {\r\n    let promiseArr = [];\r\n    for (let i in data) {\r\n      let p = new Promise((resolve, reject) => {\r\n        wx.getImageInfo({\r\n          src: data[i].image,\r\n          complete: (res) => {\r\n            let proportion = res.height / res.width;\r\n            data[i].height = 375 * proportion;\r\n            resolve(data[i])\r\n          }\r\n        })\r\n      })\r\n      promiseArr.push(p)\r\n    }\r\n    Promise.all(promiseArr).then(res => {\r\n      this.sort(res);\r\n      this.setData({\r\n        leftData,\r\n        rightData\r\n      })\r\n    })\r\n  },\r\n  sort(data) {\r\n    data.forEach(item => {\r\n      if (leftHeight <= rightHeight) {\r\n        leftHeight += item.height;\r\n        leftData.push(item)\r\n      } else {\r\n        rightHeight += item.height;\r\n        rightData.push(item);\r\n      }\r\n    });\r\n  },\r\n  onLoad(options) {\r\n    // this.create(this.data.orgData)\r\n    let that = this;\r\n    setTimeout(function () {\r\n      that.setData({\r\n        loading: true\r\n      })\r\n    }, 500);\r\n    this.rotateCircle(that.data.value);\r\n\r\n    // uploadImageToCloud: function () {\r\n      const imageUrl = 'https://example.com/image.jpg'; // 外部图片地址，替换为你的图片链接\r\n  \r\n      // wx.cloud.callFunction({\r\n      //   name: 'upload',\r\n      //   data: {\r\n      //     imageUrl: \"https://cdn.discordapp.com/attachments/1133239262922412074/1133282468380803172/charlesrogers__312b6cce-5e59-4a1b-be76-82d8467c2943.png\"\r\n      //   },\r\n      //   success: res => {\r\n      //     console.log('上传成功，云存储文件 ID:', res);\r\n      //   },\r\n      //   fail: err => {\r\n      //     console.error('上传失败:', err);\r\n      //   }\r\n      // });\r\n\r\n    wx.downloadFile({\r\n      url: 'https://cdn.discordapp.com/attachments/1133239262922412074/1133282468380803172/charlesrogers__312b6cce-5e59-4a1b-be76-82d8467c2943.png',\r\n      success: res => {\r\n        console.log(res)\r\n      }\r\n    })\r\n\r\n    // }\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow() {\r\n\r\n  },\r\n  SetColor(e) {\r\n    this.setData({\r\n      color: e.currentTarget.dataset.color,\r\n      modalName: null\r\n    })\r\n  },\r\n\r\n  SetActive(e) {\r\n    this.setData({\r\n      active: e.detail.value\r\n    })\r\n  },\r\n  getRings() {\r\n    this.data.data_list.forEach((item, index) => {\r\n      this.canvasRing = this.selectComponent(\"#can\" + index);\r\n      this.canvasRing.showCanvasRing()\r\n    })\r\n\r\n  },\r\n  drawNew(step) {\r\n    const query = wx.createSelectorQuery().in(this);\r\n    query.select('#myCanvas')\r\n      .fields({\r\n        node: true,\r\n        size: true\r\n      })\r\n      .exec(this.init.bind(this))\r\n  },\r\n  init(res) {\r\n    const canvas = res[0].node\r\n    const ctx = canvas.getContext('2d');\r\n    const dpr = wx.getSystemInfoSync().pixelRatio\r\n    canvas.width = res[0].width * dpr\r\n    canvas.height = res[0].height * dpr\r\n    ctx.scale(dpr, dpr)\r\n    var gradient = ctx.createLinearGradient(200, 100, 100, 200);\r\n    gradient.addColorStop(\"0\", \"#a57b5f\");\r\n    gradient.addColorStop(\"0.5\", \"#cc9ad1\");\r\n    gradient.addColorStop(\"1.0\", \"#b84e88\");\r\n    ctx.strokeStyle = gradient;\r\n    ctx.lineWidth = 10;\r\n    ctx.lineCap = 'round';\r\n    ctx.beginPath();\r\n    ctx.arc(110, 110, 100, 0, 2 * Math.PI, false);\r\n    ctx.stroke();\r\n  },\r\n  // 环形进度条\r\n  rotateCircle(value) {\r\n    let rotateLeft = '';\r\n    let rotateRight = '';\r\n    let backgroundRight = '';\r\n    let durationLeft = '0s';\r\n    let durationRight = '0s';\r\n\r\n    if (value >= 50) {\r\n      rotateLeft = `rotate(${((value - 50) / 100) * 360}deg)`;\r\n      rotateRight = `rotate(0deg)`;\r\n      backgroundRight = 'inherit';\r\n      durationLeft = '0.25s';\r\n      durationRight = '0s';\r\n    } else {\r\n      rotateLeft = 'rotate(0deg)';\r\n      rotateRight = `rotate(${(value / 100) * 360}deg)`;\r\n      backgroundRight = this.data.bgColor;\r\n      durationLeft = '0';\r\n      durationRight = '0.25s';\r\n      if (this.oldValue >= 50) {\r\n        durationRight = '0s';\r\n      }\r\n    }\r\n    // 记录上次的值\r\n    this.oldValue = value;\r\n    this.setData({\r\n      rotateLeft,\r\n      rotateRight,\r\n      backgroundRight,\r\n      durationLeft,\r\n      durationRight\r\n    });\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 页面上拉触底事件的处理函数\r\n   */\r\n  onReachBottom() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 用户点击右上角分享\r\n   */\r\n  onShareAppMessage() {\r\n\r\n  },\r\n  PickerChange(e) {\r\n    console.log(e);\r\n    this.setData({\r\n      index: e.detail.value\r\n    })\r\n  },\r\n  MultiChange(e) {\r\n    this.setData({\r\n      multiIndex: e.detail.value\r\n    })\r\n  },\r\n  MultiColumnChange(e) {\r\n    let data = {\r\n      multiArray: this.data.multiArray,\r\n      multiIndex: this.data.multiIndex\r\n    };\r\n    data.multiIndex[e.detail.column] = e.detail.value;\r\n    switch (e.detail.column) {\r\n      case 0:\r\n        switch (data.multiIndex[0]) {\r\n          case 0:\r\n            data.multiArray[1] = ['扁性动物', '线形动物', '环节动物', '软体动物', '节肢动物'];\r\n            data.multiArray[2] = ['猪肉绦虫', '吸血虫'];\r\n            break;\r\n          case 1:\r\n            data.multiArray[1] = ['鱼', '两栖动物', '爬行动物'];\r\n            data.multiArray[2] = ['鲫鱼', '带鱼'];\r\n            break;\r\n        }\r\n        data.multiIndex[1] = 0;\r\n        data.multiIndex[2] = 0;\r\n        break;\r\n      case 1:\r\n        switch (data.multiIndex[0]) {\r\n          case 0:\r\n            switch (data.multiIndex[1]) {\r\n              case 0:\r\n                data.multiArray[2] = ['猪肉绦虫', '吸血虫'];\r\n                break;\r\n              case 1:\r\n                data.multiArray[2] = ['蛔虫'];\r\n                break;\r\n              case 2:\r\n                data.multiArray[2] = ['蚂蚁', '蚂蟥'];\r\n                break;\r\n              case 3:\r\n                data.multiArray[2] = ['河蚌', '蜗牛', '蛞蝓'];\r\n                break;\r\n              case 4:\r\n                data.multiArray[2] = ['昆虫', '甲壳动物', '蛛形动物', '多足动物'];\r\n                break;\r\n            }\r\n            break;\r\n          case 1:\r\n            switch (data.multiIndex[1]) {\r\n              case 0:\r\n                data.multiArray[2] = ['鲫鱼', '带鱼'];\r\n                break;\r\n              case 1:\r\n                data.multiArray[2] = ['青蛙', '娃娃鱼'];\r\n                break;\r\n              case 2:\r\n                data.multiArray[2] = ['蜥蜴', '龟', '壁虎'];\r\n                break;\r\n            }\r\n            break;\r\n        }\r\n        data.multiIndex[2] = 0;\r\n        break;\r\n    }\r\n    this.setData(data);\r\n  },\r\n  TimeChange(e) {\r\n    this.setData({\r\n      time: e.detail.value\r\n    })\r\n  },\r\n  DateChange(e) {\r\n    this.setData({\r\n      date: e.detail.value\r\n    })\r\n  },\r\n  RegionChange: function (e) {\r\n    this.setData({\r\n      region: e.detail.value\r\n    })\r\n  },\r\n  ChooseImage(e) {\r\n\r\n    wx.chooseImage({\r\n      count: 1, //默认9\r\n      sizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n      sourceType: ['album'], //从相册选择\r\n      success: (res) => {\r\n        console.log(res)\r\n\r\n        // 上传到云开发平台\r\n        wx.cloud.uploadFile({\r\n          cloudPath: 'imgs', // 云存储保存路径\r\n          filePath: res.tempFilePaths[0], // 图片临时路径\r\n          success: res => {\r\n            console.log(res)\r\n          },\r\n          fail: res => {\r\n            console.log(res)\r\n          }\r\n        })\r\n\r\n        this.setData({\r\n          tempUrl: res.tempFilePaths[0]\r\n        })\r\n        \r\n\r\n\r\n\r\n        \r\n\r\n\r\n\r\n\r\n        // // 图片转base64\r\n        // wx.getFileSystemManager().readFile({\r\n        //   filePath: res.tempFilePaths[0],\r\n        //   encoding: 'base64',\r\n        //   success: res => {\r\n        //     let base64 = 'data:image/jpeg;base64,' + res.data; //不加上这串字符，在页面无法显示\r\n        //     console.log(this.data.b1)\r\n        //     let b1 = this.data.b1 ? \"是\" : \"否\";\r\n        //     let b2 = this.data.b2 ? \"是\" : \"否\";\r\n        //     let b3 = this.data.b3 ? \"是\" : \"否\";\r\n        //     console.log(b1, b2, b3)\r\n        //     wx.request({\r\n        //       // url: 'https://api.replicate.com/v1/predictions',\r\n        //       url: 'https://modelscope.cn/api/v1/studio/damo/old_photo_restoration/gradio/run/predict',\r\n        //       method: 'POST',\r\n        //       // header: {\r\n        //       //   \"Authorization\": \"Token r8_QJDy8ZahAPEQZ9fuEwF5dYjA9nLLRBj29pU8w\",\r\n        //       //   \"Content-Type\": \"application/json\"\r\n        //       // },\r\n        //       data: {\r\n        //         // \"version\": \"7de2ea26c616d5bf2245ad0d5e24f0ff9a6204578a5c876db53142edd9d2cd56\",\r\n        //         // \"input\": {\r\n        //         //   \"image\": base64,\r\n        //         //   \"background_enhance\": true,\r\n        //         //   \"codeformer_fidelity\": 0.7,\r\n        //         //   \"face_upsample\": true,\r\n        //         //   \"upscale\": 1\r\n        //         // }\r\n        //         \"fn_index\":0,\"data\":[base64,b1,b2,b3],\"dataType\":[\"image\",\"radio\",\"radio\",\"radio\"],\"event_data\":null\r\n        //       },\r\n        //       success: (res) => {\r\n\r\n        //         wx.hideLoading({\r\n        //           title: '生成中...',\r\n        //         })\r\n\r\n        //         console.log()\r\n\r\n        //         this.getTempUrl(res['data']['data'][0], res=> {\r\n        //           this.setData({\r\n        //             output: res\r\n        //           })\r\n        //         })\r\n               \r\n                \r\n        //         // let index = 1\r\n        //         // while (index < 50 && !this.data.output) {\r\n        //         //   console.log(\"获取图片\")\r\n\r\n        //         //   var resp = this.getPhoto(res['data']['urls']['get'])\r\n        //         //   console.log(resp)\r\n                 \r\n        //         //   index += 5 \r\n        //         //   this.sleep(5000)\r\n        //         //   console.log(this.data.output)\r\n        //         // }\r\n\r\n\r\n\r\n\r\n        //         //  this.getPhoto(res['data']['urls']['get']).then(res => {\r\n        //         //    console.log(\"==========result==========\")\r\n        //         //   console.log(res)\r\n        //         //   console.log(\"==========result==========\")\r\n        //         //   if(!res['data']['output']){\r\n        //         //     this.getPhoto(res['data']['urls']['get'])\r\n        //         //   }else{\r\n        //         //   console.log(\"==========url==========\")\r\n        //         //   console.log(res['data']['output'])\r\n        //         //   console.log(\"==========url==========\")\r\n        //         //   }\r\n        //         //  });\r\n\r\n        //         // if(!resp['data']['output']){\r\n        //         //   console.log(\"重新获取\")\r\n        //         // this.getPhoto(res['data']['urls']['get']);\r\n        //         // }\r\n\r\n        //         // console.log(res)\r\n        //       },\r\n        //       fail: (err) => {\r\n        //         console.error('HTTP 请求失败:', err);\r\n        //       }\r\n        //     });\r\n\r\n        //   }\r\n        // })\r\n\r\n\r\n\r\n\r\n        if (this.data.imgList.length != 0) {\r\n          this.setData({\r\n            imgList: this.data.imgList.concat(res.tempFilePaths)\r\n          })\r\n        } else {\r\n          this.setData({\r\n            imgList: res.tempFilePaths\r\n          })\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  gen(e){\r\n    wx.showLoading({\r\n          title: '等待任务队列执行...',\r\n        })\r\n    console.log(this.data.tempUrl)\r\n    wx.getFileSystemManager().readFile({\r\n      filePath: this.data.tempUrl,\r\n      encoding: 'base64',\r\n      success: res => {\r\n        let base64 = 'data:image/jpeg;base64,' + res.data;\r\n        wx.request({\r\n          url: 'https://mj.cxy-csx.top/mj/submit/imagine',\r\n          method: 'POST',\r\n          header: {\r\n            'content-type': 'application/json',\r\n          },\r\n          data: {\r\n            'base64': base64,\r\n            'notifyHook': '',\r\n            'prompt': this.data.textareaAValue,\r\n            'state': '',\r\n          },\r\n          success: (res => {\r\n\r\n            wx.showToast({\r\n              title: '等待执行...',\r\n            })\r\n\r\n            console.log(res);\r\n            console.log(res.data.result);\r\n\r\n            this.getUrl(res.data.result, this.callback)\r\n            \r\n          })\r\n          \r\n      \r\n\r\n        })\r\n       }\r\n      })\r\n    \r\n  },\r\n\r\ncallback(res){\r\n  this.setData({\r\n    process: res.progress\r\n  })\r\n  console.log(\"2222222222222222222\")\r\n  console.log(res)\r\n  console.log(\"2222222222222222222\")\r\n  if(res.progress != '100%'){\r\n    this.getUrl(res.id, this.callback)\r\n  } else {\r\n    for(let index=1; index<=4; index++){\r\n      // 获取高清图片\r\n    wx.request({\r\n      url: 'https://mj.cxy-csx.top/mj/submit/change',\r\n      method: 'post',\r\n      data: {\r\n        'action': 'UPSCALE',\r\n        'index': index,\r\n        'notifyHook': '',\r\n        'state': '',\r\n        'taskId': res.id,\r\n      },\r\n      success: (res => {\r\n        console.log(\"获取高清大图url\")\r\n        console.log(res)\r\n        console.log(\"获取高清大图url\")\r\n        // this.sleep(5)\r\n        this.getImgUrl(res.data.result, this.handel)\r\n      }\r\n    )\r\n    })\r\n    }\r\n    console.log(res)\r\n  }\r\n \r\n},\r\n\r\nsleep(milliSeconds) {\r\n  var startTime = new Date().getTime();\r\n  while (new Date().getTime() < startTime + milliSeconds);\r\n},\r\n\r\ngetImgUrl(taskId, callback){\r\n  wx.request({\r\n    url: `https://mj.cxy-csx.top/mj/task/${taskId}/fetch`,\r\n    success: (res => {\r\n      callback(res)\r\n    })\r\n  })\r\n},\r\nclick1() {\r\n  this.setShow(\"success\", \"提交成功，等待任务执行...\");\r\n},\r\nsetShow(status, message, time = 2000, fun = false) {\r\n  if (loading) {\r\n    return\r\n  }\r\n  loading = true;\r\n  try {\r\n    this.setData({\r\n      status,\r\n      message,\r\n      time,\r\n      show: true,\r\n    })\r\n    setTimeout(() => {\r\n      this.setData({\r\n        show: false,\r\n      })\r\n      loading = false;\r\n      // 触发回调函数\r\n      if (fun) {\r\n        this.end()\r\n      }\r\n    }, time)\r\n  } catch {\r\n    loading = false;\r\n  }\r\n},\r\n\r\nhandel(res){\r\n  console.log(\"===================\")\r\n  console.log(res)\r\n  console.log(\"===================\")\r\n  if(res.data.progress != '100%'){\r\n    this.getImgUrl(res.data.id, this.handel)\r\n  } else {\r\n    console.log(\"获取到图片\")\r\n    console.log(res)\r\n    let imgs = this.data.imgs;\r\n    let leftData = this.data.leftData;\r\n    let rightData = this.data.rightData;\r\n    console.log(res.data.imageUrl)\r\n    console.log(imgs)\r\n    imgs.push(res.data.imageUrl);\r\n    // wx.cloud.uploadFile({\r\n    //   cloudPath: 'imgs', // 云存储保存路径\r\n    //   filePath: res.data.imageUrl, // 图片临时路径\r\n    //   success: res => {\r\n    //     console.log(\"7777777777777777777\")\r\n    //     console.log(res)\r\n    //     console.log(\"7777777777777777777\")\r\n    //     \r\n    //     console.log(imgs)\r\n        \r\n    //   },\r\n    //   fail: res => {\r\n    //     console.log(res)\r\n    //   }\r\n    // })\r\n\r\n    this.setData({\r\n      imgs: imgs,\r\n      // orgData: orgData\r\n    })\r\n    // this.create(orgData)\r\n    console.log(\"11111111111111111111\")\r\n    console.log(this)\r\n    console.log(\"11111111111111111111\")\r\n    \r\n    // if(leftData.length %2 == 0){\r\n    //   leftData.push({\r\n    //     image: res.data.imageUrl\r\n    //   });\r\n    // }else{\r\n    //   rightData.push({\r\n    //     image: res.data.imageUrl\r\n    //   });\r\n    // }\r\n    // let pos = orgData.indexOf(res.data.imageUrl)\r\n    // if (pos < 0){\r\n      \r\n    // }\r\n    \r\n  }\r\n  \r\n  // if(!res.imageUrl){\r\n  //   this.getImgUrl(res.id, this.handel)\r\n  // } else {\r\n    \r\n  // }\r\n},\r\n\r\n\r\n\r\ngetUrl(taskId, callback){\r\n  wx.request({\r\n    url: `https://mj.cxy-csx.top/mj/task/${taskId}/fetch`,\r\n    method: \"get\",\r\n    success: (res => {\r\n      callback(res.data);\r\n    })\r\n  })\r\n},\r\n\r\n  sleep(milliSeconds) {\r\n    var startTime = new Date().getTime();\r\n    while (new Date().getTime() < startTime + milliSeconds);\r\n  },\r\n\r\n\r\n  async getPhoto(url){\r\n    const promise = new Promise(function (resolve, reject) {\r\n      wx.request({\r\n        url: url,\r\n        method: 'GET',\r\n        header: {\r\n          \"Authorization\": \"Token r8_b0Hb6tYG2w1RUuZUHOTF3mHkoDfu82t1vKVu7\",\r\n          \"Content-Type\": \"application/json\"\r\n        },\r\n        success: res => {\r\n          console.log(\"获取图片结束\", that)\r\n          console.log(res['data']['output'])\r\n          resolve();\r\n          // that.setData({\r\n          //   output: res['data']['output'],\r\n          //   flag: false\r\n          // })\r\n        },\r\n        fail: res => {\r\n          conole.log(\"获取失败\")\r\n        }\r\n      })\r\n    })\r\n    return promise.then(function(res){\r\n      return res;\r\n     },function(){}) \r\n  },\r\n\r\n  // wrapperPhoto(url){\r\n  //   this.getPhoto(url).then(res => {\r\n  //     return res;\r\n  //   })\r\n  // },\r\n\r\n  getPhoto(url) {\r\n    console.log(\"获取图片\")\r\n    return new Promise((resolve, reject) => {\r\n      wx.request({\r\n        url: url,\r\n        method: 'POST',\r\n        header: {\r\n          \"Authorization\": \"Token r8_b0Hb6tYG2w1RUuZUHOTF3mHkoDfu82t1vKVu7\",\r\n          \"Content-Type\": \"application/json\"\r\n        },\r\n        success: res => {\r\n          // console.log(res)\r\n          // if (res.data && res.data.code === '0000000') {\r\n          resolve(res)\r\n          // }\r\n        },\r\n        fail: res => {\r\n          conole.log(\"获取失败\")\r\n        }\r\n      })\r\n    })\r\n  },\r\n\r\n\r\n  ViewImage(e) {\r\n    console.log(e)\r\n    wx.previewImage({\r\n      urls: this.data.imgList,\r\n      current: e.currentTarget.dataset.url\r\n    });\r\n  },\r\n  ViewImage2(e){\r\n    console.log(e)\r\n    wx.previewImage({\r\n      urls: this.data.imgs,\r\n      current: e.currentTarget.dataset.url\r\n    });\r\n  },\r\n  DelImg(e) {\r\n    wx.showModal({\r\n      title: '提示',\r\n      content: '确定要删除图片吗？',\r\n      cancelText: '取消',\r\n      confirmText: '确定',\r\n      success: res => {\r\n        if (res.confirm) {\r\n          this.data.imgList.splice(e.currentTarget.dataset.index, 1);\r\n          this.setData({\r\n            imgList: this.data.imgList\r\n          })\r\n        }\r\n      }\r\n    })\r\n  },\r\n  textareaAInput(e) {\r\n    this.setData({\r\n      textareaAValue: e.detail.value\r\n    })\r\n  },\r\n  textareaBInput(e) {\r\n    this.setData({\r\n      textareaBValue: e.detail.value\r\n    })\r\n  },\r\n  showb1() {\r\n    this.setData({\r\n      styleA: 'transform:rotateY(180deg)',\r\n      styleB: 'transform:rotateY(0deg)'\r\n    })\r\n  },\r\n  showb2() {\r\n    this.setData({\r\n      styleA: 'transform:rotateY(0deg)',\r\n      styleB: 'transform:rotateY(-180deg)'\r\n    })\r\n  },\r\n  saveImg(e){\r\n    wx.getImageInfo({\r\n      src: this.data.output,//这里放你要下载图片的数组(多张) 或 字符串(一张) 下面代码不用改动\r\n      success: function (ret) {\r\n        var path = ret.path;\r\n        wx.saveImageToPhotosAlbum({\r\n          filePath: path,\r\n          success(result) {\r\n            console.log(\"成功\");\r\n            wx.hideLoading();\r\n            wx.showToast({\r\n              title: '下载图片成功',\r\n              duration: 2000,\r\n              mask: true,\r\n            });\r\n          },\r\n          fail(result) {\r\n            console.log(\"失败,你取消了\")\r\n            console.log(path);\r\n            wx.openSetting({\r\n              success: (res) => {\r\n                console.log(res);\r\n              }\r\n            })\r\n          }\r\n        });\r\n      },\r\n      fail: function(res){\r\n        console.log(res)\r\n      }\r\n    });\r\n  },\r\n  getTempUrl(base64data, fun){\r\n    const base64 = base64data; //base64格式图片\r\n    const time = new Date().getTime();\r\n    const imgPath = wx.env.USER_DATA_PATH + \"/cxycsx\" + time  + \".jpg\";\r\n    const imageData = base64.replace(/^data:image\\/\\w+;base64,/, \"\");\r\n    const file = wx.getFileSystemManager();\r\n    file.writeFileSync(imgPath, imageData, \"base64\");\r\n    fun(imgPath);\r\n  },\r\n\r\n  b1(e){\r\n    console.log(e.detail.value)\r\n    this.setData({\r\n      b1: e.detail.value\r\n    })\r\n  },\r\n  b2(e){\r\n    console.log(e.detail.value)\r\n    this.setData({\r\n      b2: e.detail.value\r\n    })\r\n  },\r\n  b3(e){\r\n    \r\n    this.setData({\r\n      b3: e.detail.value\r\n    })\r\n    \r\n  },\r\n  switchSex: function (e) {\r\n    if (e.detail.value) {\r\n      this.setData({\r\n        sex: \"男\"\r\n      });\r\n    } else {\r\n      this.setData({\r\n        sex: \"女\"\r\n      });\r\n    }\r\n  },\r\n  // 蛋黄派开关\r\n  eggClick() {\r\n    this.setData({\r\n      ischecked: !this.data.ischecked\r\n    })\r\n  },\r\n})
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pages/midjourney/midjourney.js b/pages/midjourney/midjourney.js
--- a/pages/midjourney/midjourney.js	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
+++ b/pages/midjourney/midjourney.js	(date 1690278380390)
@@ -253,7 +253,7 @@
       //   }
       // });
 
-    wx.downloadFile({
+    wx.request({
       url: 'https://cdn.discordapp.com/attachments/1133239262922412074/1133282468380803172/charlesrogers__312b6cce-5e59-4a1b-be76-82d8467c2943.png',
       success: res => {
         console.log(res)
Index: pages/xhs/xhs.wxml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!--pages/index/component/form/form.wxml-->\r\n<cu-custom bgColor=\"bg-gradual-red\" isBack=\"{{true}}\">\r\n  <view slot=\"content\">小红书</view>\r\n</cu-custom>\r\n\r\n<form>\r\n  \r\n\r\n  \r\n\r\n\r\n\r\n  <view class=\"cu-bar bg-white margin-top\">\r\n    <view class=\"action\">\r\n      <text class=\"cuIcon-titles text-blue\"></text>\r\n      <text class=\"text-bold\">小红书爆款文案</text>\r\n    </view>\r\n  </view>\r\n\r\n  <view class=\"cu-form-group margin-top-sm\">\r\n    <textarea maxlength=\"-1\" disabled=\"{{modalName!=null}}\" \t\tbindblur=\"textareaAInput\" placeholder=\"示例: 帮我写一篇洗面奶文案\"></textarea>\r\n  </view>\r\n\r\n</form>\r\n\r\n<view class=\"cu-bar btn-group\">\r\n    <button class=\"cu-btn bg-red shadow-blur round lg\" bindtap=\"gen\">一键生成</button>\r\n</view>\r\n\r\n<block wx-if=\"{{content}}\">\r\n\r\n  <view class=\"bg-white margin-sm padding-sm radius-lg\">\r\n  <view class=\"padding  radius\" style=\"width:100%\">\r\n    <text class=\"text-cut-99\" user-select=\"true\">\r\n      {{content}}\r\n    </text>\r\n  </view>\r\n  <view class=\"cu-bar btn-group\">\r\n    <button class=\"cu-btn bg-orange shadow-blur round lg\" bindtap=\"copyText\">复制</button>\r\n  </view>\r\n  \r\n</view>\r\n  \r\n</block>\r\n\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pages/xhs/xhs.wxml b/pages/xhs/xhs.wxml
--- a/pages/xhs/xhs.wxml	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
+++ b/pages/xhs/xhs.wxml	(date 1690352056524)
@@ -21,6 +21,12 @@
     <textarea maxlength="-1" disabled="{{modalName!=null}}" 		bindblur="textareaAInput" placeholder="示例: 帮我写一篇洗面奶文案"></textarea>
   </view>
 
+  <!-- <view class="cu-form-group margin-top-sm">
+    <view class="title">创作</view>
+    <input placeholder="示例: 帮我写一篇洗面奶文案" bindblur="textareaAInput"></input>
+  </view> -->
+
+
 </form>
 
 <view class="cu-bar btn-group">
Index: pages/xhs/xhs.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>// pages/index/component/form/form.js\r\nconst app = getApp();\r\nconst db = wx.cloud.database();\r\nPage({\r\n\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    StatusBar: app.globalData.StatusBar,\r\n    CustomBar: app.globalData.CustomBar,\r\n    index: null,\r\n    picker: ['喵喵喵', '汪汪汪', '哼唧哼唧'],\r\n    multiArray: [\r\n      ['无脊柱动物', '脊柱动物'],\r\n      ['扁性动物', '线形动物', '环节动物', '软体动物', '节肢动物'],\r\n      ['猪肉绦虫', '吸血虫']\r\n    ],\r\n    content: \"\",\r\n    objectMultiArray: [\r\n      [{\r\n          id: 0,\r\n          name: '无脊柱动物'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '脊柱动物'\r\n        }\r\n      ],\r\n      [{\r\n          id: 0,\r\n          name: '扁性动物'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '线形动物'\r\n        },\r\n        {\r\n          id: 2,\r\n          name: '环节动物'\r\n        },\r\n        {\r\n          id: 3,\r\n          name: '软体动物'\r\n        },\r\n        {\r\n          id: 3,\r\n          name: '节肢动物'\r\n        }\r\n      ],\r\n      [{\r\n          id: 0,\r\n          name: '猪肉绦虫'\r\n        },\r\n        {\r\n          id: 1,\r\n          name: '吸血虫'\r\n        }\r\n      ]\r\n    ],\r\n    multiIndex: [0, 0, 0],\r\n    time: '13:01',\r\n    date: '2022-12-25',\r\n    region: ['北京市', '北京市', '朝阳区'],\r\n    imgList: [],\r\n    modalName: null,\r\n    textareaAValue: '',\r\n    textareaBValue: ''\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n  onLoad(options) {\r\n    // sk值\r\n    db\r\n    .collection(\"config\")\r\n    .doc(\"cf009cef64bb5171006d58b43387f4b5\")\r\n    .get().then(res => {\r\n      console.log(res)\r\n      this.setData({\r\n        key: res['data']['sk']\r\n      });\r\n    });\r\n      // prompt\r\n      db\r\n      .collection(\"config\")\r\n      .doc(\"7a67810164bb5250000a141e2d7d2938\")\r\n      .get().then(res => {\r\n        console.log(res)\r\n        this.setData({\r\n          prompt: res['data']['prompt']\r\n        })\r\n      });\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 页面上拉触底事件的处理函数\r\n   */\r\n  onReachBottom() {\r\n\r\n  },\r\n\r\n  /**\r\n   * 用户点击右上角分享\r\n   */\r\n  onShareAppMessage() {\r\n\r\n  },\r\n  PickerChange(e) {\r\n    console.log(e);\r\n    this.setData({\r\n      index: e.detail.value\r\n    })\r\n  },\r\n  MultiChange(e) {\r\n    this.setData({\r\n      multiIndex: e.detail.value\r\n    })\r\n  },\r\n  MultiColumnChange(e) {\r\n    let data = {\r\n      multiArray: this.data.multiArray,\r\n      multiIndex: this.data.multiIndex\r\n    };\r\n    data.multiIndex[e.detail.column] = e.detail.value;\r\n    switch (e.detail.column) {\r\n      case 0:\r\n        switch (data.multiIndex[0]) {\r\n          case 0:\r\n            data.multiArray[1] = ['扁性动物', '线形动物', '环节动物', '软体动物', '节肢动物'];\r\n            data.multiArray[2] = ['猪肉绦虫', '吸血虫'];\r\n            break;\r\n          case 1:\r\n            data.multiArray[1] = ['鱼', '两栖动物', '爬行动物'];\r\n            data.multiArray[2] = ['鲫鱼', '带鱼'];\r\n            break;\r\n        }\r\n        data.multiIndex[1] = 0;\r\n        data.multiIndex[2] = 0;\r\n        break;\r\n      case 1:\r\n        switch (data.multiIndex[0]) {\r\n          case 0:\r\n            switch (data.multiIndex[1]) {\r\n              case 0:\r\n                data.multiArray[2] = ['猪肉绦虫', '吸血虫'];\r\n                break;\r\n              case 1:\r\n                data.multiArray[2] = ['蛔虫'];\r\n                break;\r\n              case 2:\r\n                data.multiArray[2] = ['蚂蚁', '蚂蟥'];\r\n                break;\r\n              case 3:\r\n                data.multiArray[2] = ['河蚌', '蜗牛', '蛞蝓'];\r\n                break;\r\n              case 4:\r\n                data.multiArray[2] = ['昆虫', '甲壳动物', '蛛形动物', '多足动物'];\r\n                break;\r\n            }\r\n            break;\r\n          case 1:\r\n            switch (data.multiIndex[1]) {\r\n              case 0:\r\n                data.multiArray[2] = ['鲫鱼', '带鱼'];\r\n                break;\r\n              case 1:\r\n                data.multiArray[2] = ['青蛙', '娃娃鱼'];\r\n                break;\r\n              case 2:\r\n                data.multiArray[2] = ['蜥蜴', '龟', '壁虎'];\r\n                break;\r\n            }\r\n            break;\r\n        }\r\n        data.multiIndex[2] = 0;\r\n        break;\r\n    }\r\n    this.setData(data);\r\n  },\r\n  TimeChange(e) {\r\n    this.setData({\r\n      time: e.detail.value\r\n    })\r\n  },\r\n  DateChange(e) {\r\n    this.setData({\r\n      date: e.detail.value\r\n    })\r\n  },\r\n  RegionChange: function (e) {\r\n    this.setData({\r\n      region: e.detail.value\r\n    })\r\n  },\r\n  ChooseImage() {\r\n    wx.chooseImage({\r\n      count: 4, //默认9\r\n      sizeType: ['original', 'compressed'], //可以指定是原图还是压缩图，默认二者都有\r\n      sourceType: ['album'], //从相册选择\r\n      success: (res) => {\r\n        if (this.data.imgList.length != 0) {\r\n          this.setData({\r\n            imgList: this.data.imgList.concat(res.tempFilePaths)\r\n          })\r\n        } else {\r\n          this.setData({\r\n            imgList: res.tempFilePaths\r\n          })\r\n        }\r\n      }\r\n    });\r\n  },\r\n  ViewImage(e) {\r\n    wx.previewImage({\r\n      urls: this.data.imgList,\r\n      current: e.currentTarget.dataset.url\r\n    });\r\n  },\r\n  DelImg(e) {\r\n    wx.showModal({\r\n      title: '提示',\r\n      content: '确定要删除图片吗？',\r\n      cancelText: '取消',\r\n      confirmText: '确定',\r\n      success: res => {\r\n        if (res.confirm) {\r\n          this.data.imgList.splice(e.currentTarget.dataset.index, 1);\r\n          this.setData({\r\n            imgList: this.data.imgList\r\n          })\r\n        }\r\n      }\r\n    })\r\n  },\r\n  sleep(milliSeconds) {\r\n    var startTime = new Date().getTime();\r\n    while (new Date().getTime() < startTime + milliSeconds);\r\n  },\r\n  gen(e){\r\n\r\n    console.log(this.data.textareaAValue)\r\n\r\n    if(!this.data.textareaAValue){\r\n      return;\r\n      // this.gen(e)\r\n    }\r\n    \r\n    const that = this;\r\n    const requestTask = wx.request({\r\n      url: 'https://gpt.cxy-csx.top/v1/chat/completions', // 替换为您的服务器端处理 ChatGPT 的 URL\r\n      enableChunked: true,\r\n      method: 'POST',\r\n      header: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': 'Bearer ' + this.data.key,\r\n      },\r\n      data: {\r\n        \"model\": \"gpt-3.5-turbo\",\r\n        \"messages\": [\r\n          {\r\n            \"role\": \"system\",\r\n            \"content\": this.data.prompt\r\n          },\r\n          {\r\n            \"role\": \"user\",\r\n            \"content\": this.data.textareaAValue\r\n          }\r\n        ],\r\n\r\n        \"stream\": true\r\n      },\r\n      success: (res) => {\r\n        // console.log(res)\r\n        // 处理每个部分响应并拼接\r\n        // if (res.data.choices && res.data.choices.length > 0) {\r\n        //   console.log(res.data.choices)\r\n        //   const assistantMessage = res.data.choices[0].message.content;\r\n        //   this.setData({\r\n        //     content: this.data.responseText + assistantMessage\r\n        //   });\r\n        // }\r\n      },\r\n      fail: (err) => {\r\n        console.error('HTTP 请求失败:', err);\r\n      }\r\n    });\r\n\r\n\r\n    requestTask.onHeadersReceived(function (r) {\r\n      // console.log(\"=====header======\");\r\n      // console.log(r);\r\n      // console.log(\"=====header======\");\r\n    });\r\n    requestTask.onChunkReceived(function (r) {\r\n      // let decoder = new TextDecoder('utf-8');\r\n      // let str = decoder.decode(new Uint8Array(r.data));\r\n\r\n      // let en = String.fromCharCode.apply(null,new Uint8Array(r.data));\r\n      // let de = decodeURIComponent(escape(en));\r\n\r\n      // console.log(\"onChunkReceived\", str);\r\n      let content = '';\r\n    //   const arrayBuffer = r.data;\r\n    // const uint8Array = new Uint8Array(arrayBuffer);\r\n    // let text = String.fromCharCode.apply(null, uint8Array);\r\n    // console.log(r.data)\r\n    // console.log(typeof(r.data))\r\n    // let text = that.arrayBufferToString(r)\r\n    // try {\r\n    //   JSON.parse(text.replace(\"data: \", ''))\r\n    // } catch (error) {\r\n    //   console.log(\"解析出错\")\r\n    //   console.log(text)\r\n    //   console.log(\"解析出错\")\r\n    // }\r\n    // content += JSON.parse(text.replace(\"data: \", ''))['choices'][0]['delta']['content'];\r\n    // console.log(content)\r\n\r\n      // console.log(r.data)\r\n      // let data = r.data.subarray(6)\r\n      const data16 = that.arrayBufferToHex(r.data)\t// ArrayBuffer转16进制\r\n      const requestData = that.hexToString(data16) // 16进制转字符串\r\n      try {\r\n        const regex = /{\"id.*}]}/g;\r\n\r\n        // 匹配所有符合格式的JSON字符串并存储在数组中\r\n        const matches = requestData.match(regex);\r\n\r\n        // 将匹配到的JSON字符串转换为JSON对象，并存储在结果数组中\r\n        const result = matches.map((match) => JSON.parse(match));\r\n        console.log(\"result=============\")\r\n        console.log(result);\r\n        console.log(\"result================\")\r\n        result.forEach(item => {\r\n          if(item['choices'][0]['finish_reason'] != 'stop'){\r\n            content += item['choices'][0]['delta']['content']\r\n          }\r\n        });\r\n\r\n      } catch (error) {\r\n        console.log(error)\r\n          console.log(\"解析出错=============\")\r\n          console.log(requestData)\r\n          console.log(\"解析出错=====================\")\r\n      }\r\n      // let content = JSON.parse(requestData.replace(\"data: \", ''))['choices'][0]['delta']['content'];\r\n      // console.log(content);\r\n      // let data = requestData.splice(6)\r\n      // console.log(data)\r\n      // let content = '';\r\n      // try {\r\n      //   content = JSON.parse(requestData.replace(\"data: \", ''))['choices'][0]['delta']['content'];\r\n      // } catch (error) {\r\n      //   console.log('=======error========')\r\n      //   console.log(requestData)\r\n      //   console.log(requestData.replace(\"data: \", ''))\r\n      //   console.log('========error=======')\r\n      // }\r\n\r\n      // console.log(content);\r\n      let temp = that.data.content += content\r\n      that.setData({\r\n        content: temp,\r\n        textareaAValue: ''\r\n      })\r\n    });\r\n  },\r\n\r\n\r\n  textareaAInput(e) {\r\n\r\n    console.log(e)\r\n    if(e.detail.value){\r\n      this.setData({\r\n        content: ''\r\n      })\r\n      db.collection(\"xhs\").add({\r\n        data: {\r\n            title: \"xhs\",\r\n            content: e.detail.value\r\n        },\r\n        success(res){\r\n            console.log(\"添加数据成功\",res)\r\n        },\r\n        fail(res){\r\n            console.log(\"添加数据失败\",res)\r\n        }\r\n    })\r\n    }else{\r\n      return;\r\n    }\r\n\r\n    // console.log(\"==============\")\r\n    // console.log(e.detail.value)\r\n    // console.log(\"==============\")\r\n    this.setData({\r\n      textareaAValue: e.detail.value\r\n    })\r\n    \r\n\r\n    \r\n\r\n\r\n   \r\n\r\n\r\n\r\n\r\n  },\r\n\r\n arrayBufferToString(arr){\r\n   console.log(arr)\r\n  if (typeof arr === 'string') {\r\n    return arr;\r\n  }\r\n  var dataview = new DataView(arr.data.buffer);\r\n  var ints = new Uint8Array(arr.data.byteLength);\r\n  for (var i = 0; i < ints.length; i++) {\r\n    ints[i] = dataview.getUint8(i);\r\n  }\r\n  arr = ints;\r\n  var str = '',\r\n    _arr = arr;\r\n  for (var i = 0; i < _arr.length; i++) {\r\n    var one = _arr[i].toString(2),\r\n      v = one.match(/^1+?(?=0)/);\r\n    if (v && one.length == 8) {\r\n      var bytesLength = v[0].length;\r\n      var store = _arr[i].toString(2).slice(7 - bytesLength);\r\n      for (var st = 1; st < bytesLength; st++) {\r\n        store += _arr[st + i].toString(2).slice(2);\r\n      }\r\n      str += String.fromCharCode(parseInt(store, 2));\r\n      i += bytesLength - 1;\r\n    } else {\r\n      str += String.fromCharCode(_arr[i]);\r\n    }\r\n  }\r\n  return str;\r\n},\r\n\r\n  uint8ArrayToString(uint8Array) {\r\n    let encodedString = '';\r\n\r\n    for (let i = 0; i < uint8Array.length; i++) {\r\n      encodedString += String.fromCharCode(uint8Array[i]);\r\n    }\r\n\r\n    // 解决中文乱码\r\n    try {\r\n      return decodeURIComponent(escape(encodedString));\r\n    } catch (e) {\r\n      return encodedString; // 如果解码失败，直接返回原始字符串\r\n    }\r\n  },\r\n\r\n\r\n arrayBufferToHex(arrayBuffer) {\r\n    const byteArray = new Uint8Array(arrayBuffer);\r\n    let hexString = '';\r\n  \r\n    for (let i = 0; i < byteArray.length; i++) {\r\n      const hex = byteArray[i].toString(16);\r\n      hexString += (hex.length === 1 ? '0' : '') + hex;\r\n    }\r\n  \r\n    return hexString;\r\n  },\r\n\r\nhexToString(hexString) {\r\n    const hexArray = hexString.match(/.{1,2}/g);\r\n    const byteArray = new Uint8Array(hexArray.map(byte => parseInt(byte, 16)));\r\n    // const decodedString = new TextDecoder().decode(byteArray);\r\n    // const decodedString = decodeURIComponent(escape(String.fromCharCode(...byteArray)));\r\n    // console.log(decodedString)\r\n    const decodedString = decodeURIComponent(escape(String.fromCharCode.apply(null, byteArray)));\r\n    // const decodedString = new TextDecoder().decode(byteArray);\r\n    return decodedString;\r\n  },\r\n\r\n  textareaBInput(e) {\r\n    this.setData({\r\n      textareaBValue: e.detail.value\r\n    })\r\n  },\r\n  copyText: function (e) {\r\n    console.log(e)\r\n    var textToCopy = this.data.content; // 替换为您想复制的文本\r\n    wx.setClipboardData({\r\n      data: textToCopy,\r\n      success: function () {\r\n        wx.showToast({\r\n          title: '文本已复制',\r\n          icon: 'success',\r\n          duration: 2000\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n})
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/pages/xhs/xhs.js b/pages/xhs/xhs.js
--- a/pages/xhs/xhs.js	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
+++ b/pages/xhs/xhs.js	(date 1690342822056)
@@ -1,6 +1,7 @@
 // pages/index/component/form/form.js
 const app = getApp();
 const db = wx.cloud.database();
+const log = require('../../log.js')
 Page({
 
   /**
@@ -276,7 +277,21 @@
   },
   gen(e){
 
-    console.log(this.data.textareaAValue)
+
+    console.log("=================121212================")
+    log.info(e)
+
+    log.info(this.data.textareaAValue)
+
+    console.log(this)
+    console.log(e)
+
+
+    console.log("=================121212================")
+
+    try {
+
+      console.log(this.data.textareaAValue)
 
     if(!this.data.textareaAValue){
       return;
@@ -376,6 +391,7 @@
         });
 
       } catch (error) {
+        log.error(error)
         console.log(error)
           console.log("解析出错=============")
           console.log(requestData)
@@ -399,14 +415,22 @@
       let temp = that.data.content += content
       that.setData({
         content: temp,
-        textareaAValue: ''
+        // textareaAValue: ''
       })
     });
+
+    log.info(requestTask)
+      
+    } catch (error) {
+      log.error(error)
+    }
+
+    
   },
 
 
   textareaAInput(e) {
-
+    log.info(e)
     console.log(e)
     if(e.detail.value){
       this.setData({
@@ -488,6 +512,7 @@
     try {
       return decodeURIComponent(escape(encodedString));
     } catch (e) {
+      log.error(e)
       return encodedString; // 如果解码失败，直接返回原始字符串
     }
   },
Index: .idea/workspace.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project version=\"4\">\r\n  <component name=\"ChangeListManager\">\r\n    <list default=\"true\" id=\"14265d3a-5329-4cae-a92b-241ca7b812c6\" name=\"Changes\" comment=\"\">\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/.gitignore\" beforeDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/inspectionProfiles/profiles_settings.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/inspectionProfiles/profiles_settings.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/misc.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/misc.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/.idea/vcs.xml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/.idea/vcs.xml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/app.json\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/app.json\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/pages/midjourney/midjourney.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/pages/midjourney/midjourney.js\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/pages/midjourney/midjourney.wxml\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/pages/midjourney/midjourney.wxml\" afterDir=\"false\" />\r\n      <change beforePath=\"$PROJECT_DIR$/pages/xhs/xhs.js\" beforeDir=\"false\" afterPath=\"$PROJECT_DIR$/pages/xhs/xhs.js\" afterDir=\"false\" />\r\n    </list>\r\n    <option name=\"SHOW_DIALOG\" value=\"false\" />\r\n    <option name=\"HIGHLIGHT_CONFLICTS\" value=\"true\" />\r\n    <option name=\"HIGHLIGHT_NON_ACTIVE_CHANGELIST\" value=\"false\" />\r\n    <option name=\"LAST_RESOLUTION\" value=\"IGNORE\" />\r\n  </component>\r\n  <component name=\"FileTemplateManagerImpl\">\r\n    <option name=\"RECENT_TEMPLATES\">\r\n      <list>\r\n        <option value=\"Python Script\" />\r\n      </list>\r\n    </option>\r\n  </component>\r\n  <component name=\"Git.Settings\">\r\n    <option name=\"RECENT_GIT_ROOT_PATH\" value=\"$PROJECT_DIR$\" />\r\n  </component>\r\n  <component name=\"MarkdownSettingsMigration\">\r\n    <option name=\"stateVersion\" value=\"1\" />\r\n  </component>\r\n  <component name=\"ProjectId\" id=\"2T2jq6Kw9ikuGMUEpMXES7hBpxG\" />\r\n  <component name=\"ProjectViewState\">\r\n    <option name=\"hideEmptyMiddlePackages\" value=\"true\" />\r\n    <option name=\"showLibraryContents\" value=\"true\" />\r\n  </component>\r\n  <component name=\"PropertiesComponent\"><![CDATA[{\r\n  \"keyToString\": {\r\n    \"RunOnceActivity.OpenProjectViewOnStart\": \"true\",\r\n    \"RunOnceActivity.ShowReadmeOnStart\": \"true\",\r\n    \"WebServerToolWindowFactoryState\": \"false\",\r\n    \"last_opened_file_path\": \"C:/Users/admin/Desktop/wx-ai\",\r\n    \"nodejs_package_manager_path\": \"npm\"\r\n  }\r\n}]]></component>\r\n  <component name=\"RunManager\">\r\n    <configuration name=\"urlTobase64\" type=\"PythonConfigurationType\" factoryName=\"Python\" temporary=\"true\" nameIsGenerated=\"true\">\r\n      <module name=\"wx-ai\" />\r\n      <option name=\"INTERPRETER_OPTIONS\" value=\"\" />\r\n      <option name=\"PARENT_ENVS\" value=\"true\" />\r\n      <envs>\r\n        <env name=\"PYTHONUNBUFFERED\" value=\"1\" />\r\n      </envs>\r\n      <option name=\"SDK_HOME\" value=\"\" />\r\n      <option name=\"WORKING_DIRECTORY\" value=\"$PROJECT_DIR$\" />\r\n      <option name=\"IS_MODULE_SDK\" value=\"true\" />\r\n      <option name=\"ADD_CONTENT_ROOTS\" value=\"true\" />\r\n      <option name=\"ADD_SOURCE_ROOTS\" value=\"true\" />\r\n      <EXTENSION ID=\"PythonCoverageRunConfigurationExtension\" runner=\"coverage.py\" />\r\n      <option name=\"SCRIPT_NAME\" value=\"$PROJECT_DIR$/urlTobase64.py\" />\r\n      <option name=\"PARAMETERS\" value=\"\" />\r\n      <option name=\"SHOW_COMMAND_LINE\" value=\"false\" />\r\n      <option name=\"EMULATE_TERMINAL\" value=\"false\" />\r\n      <option name=\"MODULE_MODE\" value=\"false\" />\r\n      <option name=\"REDIRECT_INPUT\" value=\"false\" />\r\n      <option name=\"INPUT_FILE\" value=\"\" />\r\n      <method v=\"2\" />\r\n    </configuration>\r\n    <recent_temporary>\r\n      <list>\r\n        <item itemvalue=\"Python.urlTobase64\" />\r\n      </list>\r\n    </recent_temporary>\r\n  </component>\r\n  <component name=\"SpellCheckerSettings\" RuntimeDictionaries=\"0\" Folders=\"0\" CustomDictionaries=\"0\" DefaultDictionary=\"application-level\" UseSingleDictionary=\"true\" transferred=\"true\" />\r\n  <component name=\"TaskManager\">\r\n    <task active=\"true\" id=\"Default\" summary=\"Default task\">\r\n      <changelist id=\"14265d3a-5329-4cae-a92b-241ca7b812c6\" name=\"Changes\" comment=\"\" />\r\n      <created>1690248257517</created>\r\n      <option name=\"number\" value=\"Default\" />\r\n      <option name=\"presentableId\" value=\"Default\" />\r\n      <updated>1690248257517</updated>\r\n      <workItem from=\"1690248258776\" duration=\"3023000\" />\r\n    </task>\r\n    <servers />\r\n  </component>\r\n  <component name=\"TypeScriptGeneratedFilesManager\">\r\n    <option name=\"version\" value=\"3\" />\r\n  </component>\r\n  <component name=\"Vcs.Log.Tabs.Properties\">\r\n    <option name=\"TAB_STATES\">\r\n      <map>\r\n        <entry key=\"763275bc-5a69-40ff-8f56-49338f44334f\">\r\n          <value>\r\n            <State>\r\n              <option name=\"SHOW_ONLY_AFFECTED_CHANGES\" value=\"true\" />\r\n              <option name=\"FILTERS\">\r\n                <map>\r\n                  <entry key=\"branch\">\r\n                    <value>\r\n                      <list>\r\n                        <option value=\"HEAD\" />\r\n                      </list>\r\n                    </value>\r\n                  </entry>\r\n                  <entry key=\"roots\">\r\n                    <value>\r\n                      <list>\r\n                        <option value=\"$PROJECT_DIR$\" />\r\n                      </list>\r\n                    </value>\r\n                  </entry>\r\n                </map>\r\n              </option>\r\n            </State>\r\n          </value>\r\n        </entry>\r\n        <entry key=\"MAIN\">\r\n          <value>\r\n            <State />\r\n          </value>\r\n        </entry>\r\n      </map>\r\n    </option>\r\n    <option name=\"OPEN_GENERIC_TABS\">\r\n      <map>\r\n        <entry key=\"763275bc-5a69-40ff-8f56-49338f44334f\" value=\"TOOL_WINDOW\" />\r\n      </map>\r\n    </option>\r\n  </component>\r\n  <component name=\"com.intellij.coverage.CoverageDataManagerImpl\">\r\n    <SUITE FILE_PATH=\"coverage/wx_ai$urlTobase64.coverage\" NAME=\"urlTobase64 Coverage Results\" MODIFIED=\"1690269264905\" SOURCE_PROVIDER=\"com.intellij.coverage.DefaultCoverageFileProvider\" RUNNER=\"coverage.py\" COVERAGE_BY_TEST_ENABLED=\"true\" COVERAGE_TRACING_ENABLED=\"false\" WORKING_DIRECTORY=\"$PROJECT_DIR$\" />\r\n  </component>\r\n</project>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.idea/workspace.xml b/.idea/workspace.xml
--- a/.idea/workspace.xml	(revision 44fdcee87eeeffcd9ab03c5a6fa335ce381a6aa3)
+++ b/.idea/workspace.xml	(date 1690420105553)
@@ -34,15 +34,15 @@
     <option name="hideEmptyMiddlePackages" value="true" />
     <option name="showLibraryContents" value="true" />
   </component>
-  <component name="PropertiesComponent"><![CDATA[{
-  "keyToString": {
-    "RunOnceActivity.OpenProjectViewOnStart": "true",
-    "RunOnceActivity.ShowReadmeOnStart": "true",
-    "WebServerToolWindowFactoryState": "false",
-    "last_opened_file_path": "C:/Users/admin/Desktop/wx-ai",
-    "nodejs_package_manager_path": "npm"
+  <component name="PropertiesComponent">{
+  &quot;keyToString&quot;: {
+    &quot;RunOnceActivity.OpenProjectViewOnStart&quot;: &quot;true&quot;,
+    &quot;RunOnceActivity.ShowReadmeOnStart&quot;: &quot;true&quot;,
+    &quot;WebServerToolWindowFactoryState&quot;: &quot;false&quot;,
+    &quot;last_opened_file_path&quot;: &quot;C:/Users/admin/Desktop/wx-ai&quot;,
+    &quot;nodejs_package_manager_path&quot;: &quot;npm&quot;
   }
-}]]></component>
+}</component>
   <component name="RunManager">
     <configuration name="urlTobase64" type="PythonConfigurationType" factoryName="Python" temporary="true" nameIsGenerated="true">
       <module name="wx-ai" />
